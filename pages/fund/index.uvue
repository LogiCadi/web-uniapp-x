<template>
	<view style="display: flex; min-height: 100%;">
		<view style="display: flex;flex-direction: row; gap: 12rpx;padding: 12rpx;">
			<view style="border: 1px solid #0f7bff; flex: 1; padding: 12rpx; border-radius: 8rpx;">
				<input v-model="input" style="height: 100%;" placeholder="è¯·è¾“å…¥åŸºé‡‘ä»£ç  å¦‚161725" />
			</view>
			<button class="btn" @tap="add">æ·»åŠ å¹¶æŸ¥è¯¢</button>
		</view>

		<view style="flex: 1; overflow: auto;">
			<view v-for="(item, idx) in list"
				style="box-shadow: 0 1px 2px #999; display: flex;flex-direction: column;gap: 12rpx;padding: 16rpx;margin: 8rpx 12rpx; border-radius: 12rpx;"
				@longpress="del(idx)">
				<view style="font-size: 18px;font-weight: bold;display: flex;flex-direction: row; flex-wrap: wrap;"
					@longpress.stop="">
					<view style="float: left; color:#0f7bff; margin-right: 8rpx;font-size: 18px;font-weight: bold">
						{{item.gz.fundcode}}
					</view>
					<view style="font-size: 18px;flex: 1">{{item.gz.name}}</view>
				</view>
				<view style="display: flex; flex-direction: row;gap:12rpx">
					ä¼°å€¼
					<template v-if="item.gz.gsz">
						<view>{{item.gz.gsz}}</view>
						<view style="font-weight: bold;" :style="{color: item.gz.gszzl> 0 ? 'red': 'green'}">
							{{item.gz.gszzl> 0 ? '+': ''}}{{item.gz.gszzl}}%
						</view>
						<view style="color: #666">({{item.gz.gztime}})</view>
					</template>
					<view v-else style="color:#888">æš‚æ— </view>
				</view>
				<view style="display: flex; flex-direction: row;gap: 8rpx; align-items: center;">
					<view>ä¸è¿‘{{item.analyze.overDays}}æ—¥å‡å€¼æ¯”</view>

					<view :style="{fontWeight: 'bold',color: item.analyze.avg > 0? 'red':'green'}">
						{{item.analyze.avg > 0 ? 'é«˜' +item.analyze.avg+'%' :"ä½"+ -item.analyze.avg+'%'}}
					</view>

					<view v-if="item.analyze.rollback">{{item.analyze.rollback === 'æ¢å¤å®šæŠ•'?'ğŸ“‰':"ğŸ“ˆ"}}</view>

					<view style="color: #666">({{item.analyze.date}})</view>
				</view>
			</view>
		</view>

		<view style="font-size: 14px; color: #999;  text-align: center; margin: 12rpx;">
			ç†è´¢æœ‰é£é™©ï¼ŒæŠ•èµ„éœ€è°¨æ…</view>
	</view>
</template>

<script setup>
	import { baseUrl } from '@/common.uts'

	let input = ref('')
	let list = ref<any>([]) //å®šä¹‰ä¸€ä¸ªå“åº”å¼å˜é‡ã€‚ç±»ä¼¼äºé€‰é¡¹å¼çš„å®šä¹‰data

	const add = () => {
		if (!input.value) {
			fetch()
			return
		}
		let codes = uni.getStorageSync('fundcode') || '161725'
		codes = codes.split(',').filter(e => e)
		codes.unshift(input.value)
		uni.setStorageSync('fundcode', codes.join(','))
		input.value = ''

		fetch()
	}
	onReady(() => {
		// console.log("é¡µé¢onReadyè§¦å‘") // é¡µé¢ç”Ÿå‘½å‘¨æœŸï¼Œç¼–å†™é¡µé¢åŠ è½½åçš„é€»è¾‘

		fetch()
	})

	const fetch = () => {
		uni.showLoading({ title: 'ç ´çƒ‚æœåŠ¡å™¨ï¼Œåˆæ¬¡åŠ è½½è¾ƒæ…¢ï¼Œè¯·è€å¿ƒç­‰å¾…...' })

		uni.request({
			url: `${baseUrl}/fund?ver=2&v=${uni.getStorageSync('fundcode') || '161725'}`,
			complete(res) {
				uni.hideLoading()
				console.log('req com', res);

				if (res.statusCode !== 200) {
					fetch()
				} else {
					list.value = res.data

					uni.setStorageSync('fundcode', res.data.map(e => e.gz.fundcode).join(','))
				}
			}
		})
	}

	const del = (idx) => {
		uni.showModal({
			title: 'åˆ é™¤',
			content: `æ˜¯å¦åˆ é™¤${list.value[idx].gz.name}`,
			success(res) {
				if (res.confirm) {
					list.value.splice(idx, 1)

					let codes = uni.getStorageSync('fundcode') || '161725'
					codes = codes.split(',').filter(e => e)
					codes.splice(idx, 1)
					uni.setStorageSync('fundcode', codes.join(','))
				}
			}
		})
	}

	const RSItap = () => {
		uni.showModal({
			title: 'RSI',
			showCancel: false,
			content: `RSIæŒ‡æ ‡æ˜¯ä¸€ç§æŠ€æœ¯åˆ†æå·¥å…·ï¼Œç”¨äºè¡¡é‡è‚¡ç¥¨æˆ–å…¶ä»–è¯åˆ¸ä»·æ ¼åœ¨è¿‡å»ä¸€æ®µæ—¶é—´å†…çš„ç›¸å¯¹å¼ºå¼±ã€‚RSI>50ï¼Œé€‚åˆå–å‡ºï¼ŒRSI<50ï¼Œé€‚åˆä¹°å…¥`
		})
	}
</script>

<style scope>
	.btn {
		background-color: #0f7bff;
		color: #FFF;
	}
</style>